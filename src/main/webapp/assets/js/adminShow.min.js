function init(e,t){function u(){var e=$("#area-title"),t=e.text();var n=t.indexOf(" ");if(n!=-1){t=t.substr(0,n)}return t}function f(){function v(){$("#success").addClass("hide");$("#error").addClass("hide");a("Ожидание...");var t=new FormData;jQuery.each($("#inputFile")[0].files,function(e,n){t.append("file-"+e,n)});$.ajax({url:e+"/image/upload/"+i.productName+"/"+i.producer+"/"+i.model,type:"POST",data:t,processData:false,contentType:false,cashed:false,success:function(e){if(e==true){a("Изображение загружено");$(".add-cancel").addClass("hide");$(".back").removeClass("hide")}else{a("Ошибка при загрузке изорбажения")}}})}var s=n.labels.length+l(n.enums);var o;if(s%2==0){o=s/2}else{o=s/2-s%2+1}var u="<div class='image-alert'><div class='alert alert-success hide' id='success'>Изображение успешно загружено.</div>"+"<div class='alert alert-danger hide image-alert' id='error'>Произошла ошибка при загрузке.\nПопробуйте отправить заного.</div><button id='btn-redirect' class='btn hide'>Назад</button></div>"+"<div id='props-area' class='hide'><div class='control-group'>"+"<div class='controls'><button id='save' class='btn btn-primary add-save form-control'>Сохранить</button>"+"<button class='btn add-cancel'>Отмена</button><button class='btn back hide'>Назад</button></div></div><h3 id='area-title'></h3>"+"<form id='image-upload' class='form-inline hide'><label>Выберите&nbsp;изображение</label>"+"<input id='inputFile' type='file' name='file' size='50' style='position:absolute; top:-200px;'/>"+"<button class='btn btn-success form-control open-file'>Открыть</button>"+"</form>"+"<div class='row-fluid'>"+"<div class='form-horizontal span6'>",f,h,p,d=0;for(f in n.labels){if(n.labels.hasOwnProperty(f)){p=n.labels[f];u+="<div class='control-group'><label for='input"+p.first+"' class='control-label'>";u+=p.second+"</label>";u+="<div class='controls'><input type='text' class='form-control input-label' name='"+p.first+"' id='input"+p.first+"'></div></div>";++d;if(d==o){u+="</div><div class='form-horizontal span6'>"}}}for(f in n.enums){if(n.enums.hasOwnProperty(f)){h=n.enums[f];u+="<div class='control-group'><label for='input"+f+"' class='control-label'>";u+=h.first+"</label>";u+="<div class='controls'><select name='"+f+"' class='form-control input-enum' id='input"+f+"'>";for(f in h.second){if(h.second.hasOwnProperty(f)){u+="<option value='"+h.second[f].first+"'>"+h.second[f].second+"</option>"}}u+="</select></div></div>";++d;if(d==o){u+="</div><div class='form-horizontal span6'>"}}}u+="</div>";r=true;$(".add-new").after(u);$(".input-label").on("keypress",function(e){if(e.keyCode==13){e.preventDefault();c()}});$(".input-enum").on("keypress",function(e){if(e.keyCode==13){e.preventDefault();c()}});$(".add-cancel").click(function(e){e.preventDefault();var t;for(f in n.labels){if(n.labels.hasOwnProperty(f)){t=$("#input"+n.labels[f].first);t.popover("destroy");t.val("")}}for(f in n.enums){if(n.enums.hasOwnProperty(f)){t=$("#input"+f);t.popover("destroy");t.val("NAN")}}$("#props-area").addClass("hide");$("#image-upload-edit").addClass("hide");$(".add-new").removeClass("hide");$(".thumbnails").removeClass("hide")});$(".back").click(function(n){n.preventDefault();window.location.href=e+"/auth/administration/editor/show/"+t});$(".add-save").click(function(e){e.preventDefault();c()});$(".open-file").click(function(e){e.preventDefault();$("#inputFile").click()});$("input:file").change(function(){var e=$(this).val();$(".filename").html(e);if(e!=="")v()});$("#btn-redirect").click(function(n){n.preventDefault();window.location.href=e+"/auth/administration/editor/show/"+t});}function l(e){if(e.__count__!==undefined){return e.__count__}if(Object.keys){return Object.keys(e).length}var t=0,n;for(n in e){if(e.hasOwnProperty(n)){t+=1}}return t}function c(){var n=$(".input-label"),r=$(".input-enum"),s={properties:[]},o;a("Ожидание...");for(var u=0;u<n.length;++u){s.properties.push({first:"label",second:{first:$(n[u]).attr("name"),second:$(n[u]).val()}})}for(u=0;u<r.length;++u){s.properties.push({first:"enum",second:{first:$(r[u]).attr("name"),second:$(r[u]).val()}})}for(u=0;u<s.properties.length;++u){$("#input"+s.properties[u].second.first).popover("destroy")}s=JSON.stringify(s);var f;$.ajax({url:e+"/auth/administration/editor/edit/"+t+"/"+i.model,data:s,contentType:"application/json",type:"POST",cashed:false,success:function(e){if(e.success){i={model:e.objectModel,producer:e.objectProducer,productName:e.objectProduct};a("Продукт сохранен");$("#image-upload").removeClass("hide");$(".add-cancel").addClass("hide");$(".back").removeClass("hide")}else{var t=0,n;a("Ошибка при сохранении продкута");for(t;t<e.notSetFields.length;++t){n=$("#input"+e.notSetFields[t]);n.popover({content:"Поле должно быть заполнено",trigger:"manual"});n.popover("show")}for(t=0;t<e.failedFields.length;++t){n=$("#input"+e.failedFields[t]);n.popover({content:"Данные не верные",trigger:"manual"});n.popover("show")}}}})}var n={labels:{},enums:{}},r=false,i={model:"",producer:"",productName:""},s=false;$.ajax({url:e+"/auth/administration/editor/get/full/properties/"+t,type:"POST",cashed:false,success:function(e){console.log(e);n=e;r=true;f()}});$(".add-new").click(function(e){e.preventDefault();if(r==true){$(".thumbnails").addClass("hide");$(".add-new").addClass("hide");$("#props-area").removeClass("hide");$("#area-title").text("Добавление");s=false}});$(".product-edit").click(function(n){n.preventDefault();var r;var o=$(this).attr("id").substr(5);s=true;$.ajax({url:e+"/auth/administration/editor/get/edit/item/"+o+"/"+t,type:"POST",cashed:false,success:function(e){r=e;var t=e.properties;i={model:e.objectModel,producer:e.objectProducer,productName:e.objectProduct};var n;for(n=0;n<t.length;++n){var s=$("#input"+t[n].second.first);s.val(t[n].second.second)}$(".thumbnails").addClass("hide");$(".add-new").addClass("hide");$("#image-upload-edit").removeClass("hide");$("#props-area").removeClass("hide");$("#image-upload").removeClass("hide");$("#area-title").text("Редактирование")}})});$(".product-remove").click(function(n){n.preventDefault();var r;var i=$(this).attr("id").substr(7);$.ajax({url:e+"/auth/administration/editor/remove/item/"+i,type:"POST",cashed:false,success:function(n){if(n==true){window.location.href=e+"/auth/administration/editor/show/"+t}}})});var o=$(".thumbnail");o.mouseover(function(e){$(this).find(".offset9").css("visibility","visible")});o.mouseout(function(e){$(this).find(".offset9").css("visibility","hidden")});var a=function(e){var t=$("#area-title");var n=u();return function(){t.text(n+" - "+e)}()}}